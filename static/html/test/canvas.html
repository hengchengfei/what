<!DOCTYPE html>
<html>
 <head>
    <meta charset="utf-8">
    <title>Canvas demo</title>
    <script src="http://127.0.0.1:8080/assets/js/vendor/jquery.min.js"></script>
 </head>
<body>

<img data-url="http://127.0.0.1:8080/assets/img/test/include/W2015032421063014700089536-middle.jpg" data-text="我与闺蜜的日常" data-type="2">

<script type="text/javascript">

   function draw_text(img_url, img_text, img_type, width, height) {

        if ( ! $("#canvas").length) {
            $("body").prepend("<canvas id=\"canvas\"></canvas>");
        }

        var cvs = $("#canvas")[0],
            ctx = cvs.getContext("2d"),
            img = new Image();

        cvs.width = width;
        cvs.height = height;

        ctx.clearRect(0, 0, width, height);
        ctx.font = "normal 16px microsoft yahei";

        img.onload = function () {
            ctx.drawImage(img, 0, 0, width, height);

            if (img_type === 0) {

                ctx.fillStyle = "rgba(0, 0, 0, 0.3)";
                ctx.fillRect(0, height - 40, width, height);

                ctx.textAlign = 'left';
                ctx.textBaseline = 'middle';
                ctx.fillStyle = "white";
                ctx.fillText("界记教历史", 5, height - 20);
            } else {

                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillStyle = "white";
                ctx.fillText("界记教历史", width / 2, height / 2);
            }
            return cvs.toDataURL("image/png");
        }
        img.src = img_url;
   }

   var url = "http://127.0.0.1:8080/assets/img/test/include/W2015032421063014700089536-middle.jpg";
   var text = "测试文字";

   draw_text(url, text, 0, 500, 500);

</script>
</body>
</html>