<!doctype html>
<html ng-app="What">
<head>
    <meta charset="UTF-8">
    <title></title>

    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
<meta name="description" content="慢点，属于你和你的同类">
<meta name="keywords" content="慢点，同类">

<link rel="icon" href="/assets/img/logo_92c213c.png" type="image/x-icon">
<link rel="shortcut icon" href="/assets/img/logo_92c213c.png" type="image/x-icon">

<link type="text/css" rel="stylesheet" href="/assets/css/vendor/normalize.css">
<link type="text/css" rel="stylesheet" href="/assets/css/vendor/main.css">
<link type="text/css" rel="stylesheet" href="/assets/css/common/common.css">
<!--[if lt IE 8]>
<link rel="stylesheet" href="/assets/css/common/ie-hack.css">
<![endif]-->
    <style>body{background-color:#f1f1f1}.wait{z-index:100;position:fixed;top:0;right:0;bottom:0;left:0;background-color:#fff}@-webkit-keyframes rotate{from{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(360deg)}}.wait div{position:relative;left:50%;margin-top:50%;margin-left:-17px;width:35px;height:35px;background-image:url(/assets/img/topic/include/drap_d2cec69.png);background-size:100%;-webkit-animation-name:rotate;-webkit-animation-duration:1.5s;-webkit-animation-iteration-count:infinite;-webkit-animation-timing-function:linear}.cicle{border-top-left-radius:50%;border-top-right-radius:50%;border-bottom-left-radius:50%;border-bottom-right-radius:50%}.page{margin:0 auto;padding-top:1px;padding-bottom:66px}.panel{position:relative;border-top-left-radius:12px;border-top-right-radius:12px;border-bottom-left-radius:12px;border-bottom-right-radius:12px;margin:12px 7px 0;background-color:#fff;text-align:left}.c_head{height:57px}.c_head img{position:absolute;top:8px;left:11px;border-top-left-radius:22px;border-top-right-radius:22px;border-bottom-left-radius:22px;border-bottom-right-radius:22px}.u_name,.c_time{margin-left:72px;position:relative;top:10px}.u_name{font-size:15px;color:#333}.c_time{font-size:12px;color:#999}.c_img{position:relative}.c_img::after{content:" ";display:block;width:38px;height:38px;position:absolute;top:15px;right:15px;background-image:url(/assets/img/topic/include/play_4677b61.png);background-size:100%;z-index:20}.c_img *{width:100%;height:100%}.i_one div[index="1"],.i_three div[index="1"]{opacity:1}.i_one div[index="2"],.i_three div[index="2"]{opacity:0}.i_one div,.i_three div,.i_four>div{position:absolute;top:0}.i_three{perspective:100em;-webkit-perspective:100em;-o-perspective:100em;-ms-perspective:100em;-moz-perspective:100em;perspective-origin:50% 50%;-webkit-perspective-origin:50% 50%;-o-perspective-origin:50% 50%;-ms-perspective-origin:50% 50%;-moz-perspective-origin:50% 50%}.i_four{overflow:hidden}.i_four>div{perspective:100em;-webkit-perspective:100em;-o-perspective:100em;-ms-perspective:100em;-moz-perspective:100em}.i_four_one{left:-50%;perspective-origin:left center;-webkit-perspective-origin:left center;-o-perspective-origin:left center;-ms-perspective-origin:left center;-moz-perspective-origin:left center}.i_four_two{right:-50%;perspective-origin:100% 50%;-webkit-perspective-origin:100% 50%;-o-perspective-origin:100% 50%;-ms-perspective-origin:100% 50%;-moz-perspective-origin:100% 50%}.i_four div div{position:absolute;top:0;left:0}.i_four div div div{width:50%;background-size:cover}.i_four div[index="1"] div,.i_four div[index="2"] div{margin-left:50%;background-position:center left}.i_four div[index="3"] div,.i_four div[index="4"] div{background-position:center right}.i_four div[index="1"],.i_four div[index="3"]{z-index:11}.i_four div[index="2"],.i_four div[index="4"]{z-index:10}.i_five{overflow:hidden}.i_five>div{position:absolute;top:0;left:0}.i_five div[index="1"]{z-index:11}.i_five div[index="2"]{z-index:10}.i_five div div{width:25%;height:16.7%;background-size:400%,400%;float:left}.i_seven{overflow:hidden;perspective:100em;-webkit-perspective:100em;-o-perspective:100em;-ms-perspective:100em;-moz-perspective:100em;perspective-origin:50% 50%;-webkit-perspective-origin:50% 50%;-o-perspective-origin:50% 50%;-ms-perspective-origin:50% 50%;-moz-perspective-origin:50% 50%}.i_seven div{width:200%;position:absolute;top:0}.i_seven div[index="1"]{left:-100%;opacity:1;z-index:11}.i_seven div[index="1"] img{float:right;width:50%;z-index:10}.i_seven div[index="2"]{right:-100%;opacity:0}.i_seven div[index="2"] img{width:50%}.c_topic{font-size:15px;line-height:1em;margin-top:10px;color:#486d9a}.c_topic li{display:inline-block;margin-left:20px}.c_zan{text-align:center;margin-top:9px}.c_zan em{width:47px;display:inline-block;margin:0 auto;padding-top:50px;font-size:12px;background-size:47px;background-repeat:no-repeat}.c_zan .before{color:#486d9a;background-image:url(/assets/img/topic/include/praise_923f22e.png)}.c_zan .after{color:#fab12d;background-image:url(/assets/img/topic/include/praise_press_0f52a00.png)}.c_watched{position:absolute;bottom:10px;left:22px}.c_watched em{background-image:url(/assets/img/topic/include/watched_351a959.png);background-size:12px;background-repeat:no-repeat;padding-left:16px;font-size:10px;color:#dddada}.c_view p{display:inline-block;font-size:10px;color:#dddada}.c_content{width:17px;height:22px;position:absolute;right:22px;bottom:12px;background-image:url(/assets/img/topic/include/comments_eeeaa9c.png);background-size:17px;background-repeat:no-repeat}.c_foot{height:37px;margin-top:-30px}</style>
</head>
<body>

    <div class="wait">
        <div></div>
    </div>

    <div class="page none" ng-controller="TopicCtrl">
        <section class="panel" ng-repeat="item in list">
            <div class="c_head">
                <img class="cicle" src="{{item.create_user.user_avatar}}" width="44" height="44">
                <p class="u_name" ng-bind="item.create_user.user_name"></p>
                <p class="c_time" ng-bind="item.create_time | time"></p>
            </div>

            <!-- start animation -->
                <!-- 我是时尚 ok -->
                <div class="c_img i_one" onclick="img_one(this)" ng-if="item.animation.animation_class == 'WhatAnimationEraseInOut'">
                    <div index="1">
                        <img src="{{item.photos[0].url_middle}}">
                    </div>
                    <div index="2">
                        <img src="{{item.photos[1].url_middle}}">
                    </div>
                </div>

                <!-- 萌化～ -->
                <div class="c_img i_two" onclick="img_two(this)" ng-if="item.animation.animation_class == 'WhatAnimationOglFlip'">
                    <div index="1" data-image="url({{item.photos[0].url_middle}});"></div>
                    <div index="2" data-image="url({{item.photos[1].url_middle}});"></div>
                </div>

                <!-- 不吃药打死你 ok -->
                <div class="c_img i_one" onclick="img_one(this)" ng-if="item.animation.animation_class == 'WhatAnimationRippleEffect'">
                    <div index="1">
                        <img src="{{item.photos[0].url_middle}}">
                    </div>
                    <div index="2">
                        <img src="{{item.photos[1].url_middle}}">
                    </div>
                </div>
                
                <!-- 好青年 ok -->
                <div class="c_img i_four" onclick="img_four(this)" ng-if="item.animation.animation_class == 'WhatAnimationOpenDoor'">
                    <div class="i_four_one">
                        <div index="1">
                            <div style="background-image: url({{item.photos[0].url_middle}});"></div>
                        </div>
                        <div index="2">
                            <div style="background-image: url({{item.photos[1].url_middle}});"></div>
                        </div>
                    </div>
                    <div class="i_four_two">
                        <div index="3">
                            <div style="background-image: url({{item.photos[0].url_middle}});"></div>
                        </div>
                        <div index="4">
                            <div style="background-image: url({{item.photos[1].url_middle}});"></div>
                        </div>
                    </div>
                </div> 
                
                <!-- 我为何如此美 ok -->
                <div class="c_img i_five" onclick="img_five(this)" ng-if="item.animation.animation_class == 'WhatAnimationFallen'">
                    <div index="1">
                        <div class="three_1" style="background-image:url({{item.photos[0].url_middle}});background-position: 0% 0%;"></div>
                        <div class="three_2" style="background-image:url({{item.photos[0].url_middle}});background-position: 33% 0%;"></div>
                        <div class="three_3" style="background-image:url({{item.photos[0].url_middle}});background-position: 66% 0%;"></div>
                        <div class="three_4" style="background-image:url({{item.photos[0].url_middle}});background-position: 99% 0%;"></div>

                        <div class="three_5"  style="background-image:url({{item.photos[0].url_middle}});background-position: 0% 20%;"></div>
                        <div class="three_6"  style="background-image:url({{item.photos[0].url_middle}});background-position: 33% 20%;"></div>
                        <div class="three_7"  style="background-image:url({{item.photos[0].url_middle}});background-position: 66% 20%;"></div>
                        <div class="three_8" style="background-image:url({{item.photos[0].url_middle}});background-position: 99% 20%;"></div>

                        <div class="three_9"  style="background-image:url({{item.photos[0].url_middle}});background-position: 0% 40%;"></div>
                        <div class="three_10"  style="background-image:url({{item.photos[0].url_middle}});background-position: 33% 40%;"></div>
                        <div class="three_11"  style="background-image:url({{item.photos[0].url_middle}});background-position: 66% 40%;"></div>
                        <div class="three_12"  style="background-image:url({{item.photos[0].url_middle}});background-position: 99% 40%;"></div>

                        <div class="three_13"  style="background-image:url({{item.photos[0].url_middle}});background-position: 0% 60%;"></div>
                        <div class="three_14"  style="background-image:url({{item.photos[0].url_middle}});background-position: 33% 60%;"></div>
                        <div class="three_15"  style="background-image:url({{item.photos[0].url_middle}});background-position: 66% 60%;"></div>
                        <div class="three_16"  style="background-image:url({{item.photos[0].url_middle}});background-position: 99% 60%;"></div>

                        <div class="three_17"  style="background-image:url({{item.photos[0].url_middle}});background-position: 0% 80%;"></div>
                        <div class="three_18"  style="background-image:url({{item.photos[0].url_middle}});background-position: 33% 80%;"></div>
                        <div class="three_19"  style="background-image:url({{item.photos[0].url_middle}});background-position: 66% 80%;"></div>
                        <div class="three_20"  style="background-image:url({{item.photos[0].url_middle}});background-position: 99% 80%;"></div>

                        <div class="three_21"  style="background-image:url({{item.photos[0].url_middle}});background-position: 0% 100%;"></div>
                        <div class="three_22"  style="background-image:url({{item.photos[0].url_middle}});background-position: 33% 100%;"></div>
                        <div class="three_23"  style="background-image:url({{item.photos[0].url_middle}});background-position: 66% 100%;"></div>
                        <div class="three_24"  style="background-image:url({{item.photos[0].url_middle}});background-position: 99% 100%;"></div>
                    </div>
                    <div index="2">
                        <div class="three_1" style="background-image:url({{item.photos[1].url_middle}});background-position: 0% 0%;"></div>
                        <div class="three_2" style="background-image:url({{item.photos[1].url_middle}});background-position: 33% 0%;"></div>
                        <div class="three_3" style="background-image:url({{item.photos[1].url_middle}});background-position: 66% 0%;"></div>
                        <div class="three_4" style="background-image:url({{item.photos[1].url_middle}});background-position: 99% 0%;"></div>

                        <div class="three_5"  style="background-image:url({{item.photos[1].url_middle}});background-position: 0% 20%;"></div>
                        <div class="three_6"  style="background-image:url({{item.photos[1].url_middle}});background-position: 33% 20%;"></div>
                        <div class="three_7"  style="background-image:url({{item.photos[1].url_middle}});background-position: 66% 20%;"></div>
                        <div class="three_8" style="background-image:url({{item.photos[1].url_middle}});background-position: 99% 20%;"></div>

                        <div class="three_9"  style="background-image:url({{item.photos[1].url_middle}});background-position: 0% 40%;"></div>
                        <div class="three_10"  style="background-image:url({{item.photos[1].url_middle}});background-position: 33% 40%;"></div>
                        <div class="three_11"  style="background-image:url({{item.photos[1].url_middle}});background-position: 66% 40%;"></div>
                        <div class="three_12"  style="background-image:url({{item.photos[1].url_middle}});background-position: 99% 40%;"></div>

                        <div class="three_13"  style="background-image:url({{item.photos[1].url_middle}});background-position: 0% 60%;"></div>
                        <div class="three_14"  style="background-image:url({{item.photos[1].url_middle}});background-position: 33% 60%;"></div>
                        <div class="three_15"  style="background-image:url({{item.photos[1].url_middle}});background-position: 66% 60%;"></div>
                        <div class="three_16"  style="background-image:url({{item.photos[1].url_middle}});background-position: 99% 60%;"></div>

                        <div class="three_17"  style="background-image:url({{item.photos[1].url_middle}});background-position: 0% 80%;"></div>
                        <div class="three_18"  style="background-image:url({{item.photos[1].url_middle}});background-position: 33% 80%;"></div>
                        <div class="three_19"  style="background-image:url({{item.photos[1].url_middle}});background-position: 66% 80%;"></div>
                        <div class="three_20"  style="background-image:url({{item.photos[1].url_middle}});background-position: 99% 80%;"></div>

                        <div class="three_21"  style="background-image:url({{item.photos[1].url_middle}});background-position: 0% 100%;"></div>
                        <div class="three_22"  style="background-image:url({{item.photos[1].url_middle}});background-position: 33% 100%;"></div>
                        <div class="three_23"  style="background-image:url({{item.photos[1].url_middle}});background-position: 66% 100%;"></div>
                        <div class="three_24"  style="background-image:url({{item.photos[1].url_middle}});background-position: 99% 100%;"></div>
                    </div>
                </div>

                <!-- 自拍中勿打扰 -->
                <div class="c_img i_one" onclick="img_one(this)" ng-if="item.animation.animation_class == 'WhatAnimationYUGLPowDistortion'">
                    <div index="1">
                        <img src="{{item.photos[0].url_middle}}">
                    </div>
                    <div index="2">
                        <img src="{{item.photos[1].url_middle}}">
                    </div>
                </div>

                <!-- 基情噼里啪啦 ok -->
                <div class="c_img i_seven" onclick="img_seven(this)" ng-if="item.animation.animation_class == 'WhatAnimationYUGLSwap'">
                    <div index="1">
                        <img src="{{item.photos[0].url_middle}}">
                    </div>
                    <div index="2">
                        <img src="{{item.photos[1].url_middle}}">
                    </div>
                </div> 

                <!-- 反差萌 ok -->
                <div class="c_img i_one" onclick="img_one(this)" ng-if="item.animation.animation_class == 'WhatAnimationYUGLFlyeye'">
                    <div index="1">
                        <img src="{{item.photos[0].url_middle}}">
                    </div>
                    <div index="2">
                        <img src="{{item.photos[1].url_middle}}">
                    </div>
                </div>
            <!-- end animation -->

            <ul class="c_topic">
                <li ng-repeat="ele in item.topics">
                    <a href="?id={{ele.id}}" ng-bind="ele.name"></a>
                </li>
            </ul>
            <div class="c_zan">
                <em class="before">同感</em>
            </div>
            <div class="c_foot">
                <div class="c_watched">
                    <em ng-bind="item.count_info.view_count"></em>
                </div>
                <a href="../content?id={{item.id}}"><em class="c_content"></em></a>
            </div>
        </section>
    </div>

    <script type="text/javascript" charset="utf-8" src="/assets/js/vendor/jquery.min.js"></script>
<script type="text/javascript" charset="utf-8" src="/assets/js/vendor/angular.min.js"></script>
<script type="text/javascript" charset="utf-8" src="/assets/js/vendor/move.js"></script>
<script type="text/javascript" charset="utf-8" src="/assets/js/vendor/jquery.ripples.js"></script>
<script type="text/javascript" charset="utf-8" src="/assets/js/image.js"></script>
<script type="text/javascript" charset="utf-8" src="/assets/js/public.js"></script>
<div id="download" class="none" style="height:54px; position:fixed; bottom:0; left:0; right:0; z-index:100; border-top: 1px solid #dddada;background-color:white;">
        <a href="javascript:;" onclick="download_click()" style="display:block; width:100%; height:100%; color: rgb(6, 6, 6);">
            <img src="/assets/img/include/download/include/appicon_803b8c5.png" width="45" height="45" style="position:absolute; top:5px; left: 8px;">
            <p style="margin-left:64px; margin-top:6px;">慢点<br>属于你和你的同类</p>
            <img src="/assets/img/include/download/include/button_download_9ef9b7d.png" width="90" height="35" style="position:absolute; top:10px; right: 8px;">
        </a>
</div>

<div class="text none" style="position: absolute;top: 0;right: 0;bottom: 0;left: 0;background-color: black; opacity: 0.6;z-index: 99;">
    <img src="/assets/img/include/download/include/text_d177543.png" style="width:255px; position:absolute; top:0; right:10px;">
</div>

<script>
        $(".text").on("click", function () {
            $(this).toggleClass("none");
        });

        if (navigator.userAgent.match(/Mac OS X/i)) {

            $("#download").removeClass("none");
            if ( ! navigator.userAgent.match(/MicroMessenger/i)) {

                if (location.pathname.match(/topic/)) {
                    $("#download a").attr("href", "selfwhat://?type=topic" + "&id=" + get_url_param("id") + "&name=" + location.hash);
                } else if (location.pathname.match(/content/)) {
                    $("#download a").attr("href", "selfwhat://?type=content" + "&id=" + get_url_param("id"));
                }
            }
        }

        function download_click () {
                if (navigator.userAgent.match(/MicroMessenger/i)) {
                        $(".text").removeClass("none");
                } else {
                        setTimeout(function () {
                                location.href = "https://itunes.apple.com/app/id958445502?mt=8&l=zh";
                        }, 1000);
                }
        }
</script>

    <script>
        var app = angular.module('What', [], angular.noop);

        app.controller('TopicCtrl', function ($scope, $http) {
            $scope.list = [];

            $http.get("http://api.mkwhat.com/self-app//topic/contentList?topic_id=" + get_url_param("id") + "&page=1")
            .success(function (data) {
                if ( ! data.data || ! data.data.contents) {
                    get_topic_error();
                    return;
                }

                $scope.list = data.data.contents;

                setTimeout(function () {
                    $(".c_img").css("height", $(".panel").css("width"));
                }, 100);

                $(".page").removeClass("none");
                $(".wait").addClass("none");
                var url_link = data.data.share_info.url_link;
                $("title").html(url_link.substr(url_link.indexOf("#")));

                /* start add text to image */
                if ( ! $("#canvas").length) {
                    $("body").prepend("<canvas id=\"canvas\" style=\"display: none;\"></canvas>");
                }
                var cvs = $("#canvas")[0], ctx = cvs.getContext("2d");
                angular.forEach($scope.list, function (cont, id) {
                    angular.forEach(cont.photos, function (item, key) {
                            var img = new Image();

                            img.onload = function () {
                                    cvs.width = img.width;
                                    cvs.height = img.height;

                                    ctx.clearRect(0, 0, cvs.width, cvs.height);
                                    ctx.font = "normal 16px microsoft yahei";

                                    ctx.drawImage(img, 0, 0, cvs.width, cvs.height);

                                    if (item.type == 0) {
                                            ctx.fillStyle = "rgba(0, 0, 0, 0.3)";
                                            ctx.fillRect(0, cvs.height - 40, cvs.width, cvs.height);
                                            ctx.textAlign = 'left';
                                            ctx.textBaseline = 'middle';
                                            ctx.fillStyle = "white";
                                            ctx.fillText(item.text, 5, cvs.height - 20);
                                    } else {
                                            ctx.textAlign = 'center';
                                            ctx.textBaseline = 'middle';
                                            ctx.fillStyle = "white";
                                            ctx.fillText(item.text, cvs.width / 2, cvs.height / 2);
                                    }
                                    item.url_middle = cvs.toDataURL("image/png");
                                    $scope.list[id].photos[key] = item;
                                    $scope.$digest()
                            }
                            img.src = item.url_middle.replace("img.mkwhat.com", "www.mkwhat.com");
                    });
                });
                /* end add text to image */
            })
            .error(get_topic_error);
        });

        app.filter('time', function () {

            return function (input) {

                if ( ! input) return "";

                var time = (Date.now() - input) / 1000;

                if (time <= 0) {
                    return "刚刚";
                }
                if (time < 60) {
                    return Math.floor(time) + "秒前";
                }
                if (time < 60 * 60) {
                    return Math.floor(time / 60) + "分钟前";
                }
                if (time < 60 * 60 * 24) {
                    return Math.floor(time / 60) + "小时前";
                }

                return Math.floor(time / 60 / 60 / 24) + "小时前";
            };
        });

        function get_topic_error () {
            // body...
        }
    </script>
</body>
</html>
